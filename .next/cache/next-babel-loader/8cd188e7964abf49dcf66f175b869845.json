{"ast":null,"code":"import { useMemo, useEffect } from 'react';\nimport { useLoader, useThree, useFrame } from 'react-three-fiber';\nimport { SMAAImageLoader, BlendFunction, EffectComposer, EffectPass, RenderPass, SMAAEffect, EdgeDetectionMode, SMAAPreset, SSAOEffect, NormalPass } from 'postprocessing/build/postprocessing';\nimport { HalfFloatType } from 'three'; // Fix smaa loader signature\n\nconst _load = SMAAImageLoader.prototype.load;\n\nSMAAImageLoader.prototype.load = function (_, set) {\n  return _load.bind(this)(set);\n};\n\nexport default function Post() {\n  const {\n    gl,\n    scene,\n    camera,\n    size\n  } = useThree();\n  const smaa = useLoader(SMAAImageLoader);\n  const composer = useMemo(() => {\n    const composer = new EffectComposer(gl);\n    composer.addPass(new RenderPass(scene, camera));\n    const smaaEffect = new SMAAEffect(...smaa);\n    smaaEffect.colorEdgesMaterial.setEdgeDetectionThreshold(0.1);\n    const normalPass = new NormalPass(scene, camera);\n    const ssaoEffect = new SSAOEffect(camera, normalPass.renderTarget.texture, {\n      blendFunction: BlendFunction.MULTIPLY,\n      samples: 30,\n      rings: 4,\n      distanceThreshold: 1,\n      // Render distance depends on camera near&far.\n      distanceFalloff: 0.0,\n      // No need for falloff.\n      rangeThreshold: 0.05,\n      // Larger value works better for this camera frustum.\n      rangeFalloff: 0.01,\n      luminanceInfluence: 0.6,\n      radius: 30,\n      scale: 0.55,\n      bias: 0.5\n    });\n    const effectPass = new EffectPass(camera, smaaEffect, ssaoEffect);\n    effectPass.renderToScreen = true;\n    composer.addPass(normalPass);\n    composer.addPass(effectPass);\n    return composer;\n  }, []);\n  useEffect(() => void composer.setSize(size.width, size.height), [size]);\n  return useFrame((_, delta) => composer.render(delta), 1);\n}","map":{"version":3,"sources":["/Users/feral/Projects/ricardomatias.github.io/components/scenes/Effects.js"],"names":["useMemo","useEffect","useLoader","useThree","useFrame","SMAAImageLoader","BlendFunction","EffectComposer","EffectPass","RenderPass","SMAAEffect","EdgeDetectionMode","SMAAPreset","SSAOEffect","NormalPass","HalfFloatType","_load","prototype","load","_","set","bind","Post","gl","scene","camera","size","smaa","composer","addPass","smaaEffect","colorEdgesMaterial","setEdgeDetectionThreshold","normalPass","ssaoEffect","renderTarget","texture","blendFunction","MULTIPLY","samples","rings","distanceThreshold","distanceFalloff","rangeThreshold","rangeFalloff","luminanceInfluence","radius","scale","bias","effectPass","renderToScreen","setSize","width","height","delta","render"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,SAAlB,QAAmC,OAAnC;AACA,SAASC,SAAT,EAAoBC,QAApB,EAA8BC,QAA9B,QAA8C,mBAA9C;AACA,SACCC,eADD,EAECC,aAFD,EAGCC,cAHD,EAICC,UAJD,EAKCC,UALD,EAMCC,UAND,EAOCC,iBAPD,EAQCC,UARD,EASCC,UATD,EAUCC,UAVD,QAWO,qCAXP;AAYA,SACCC,aADD,QAEO,OAFP,C,CAIA;;AACA,MAAMC,KAAK,GAAGX,eAAe,CAACY,SAAhB,CAA0BC,IAAxC;;AAEAb,eAAe,CAACY,SAAhB,CAA0BC,IAA1B,GAAiC,UAASC,CAAT,EAAYC,GAAZ,EAAiB;AACjD,SAAOJ,KAAK,CAACK,IAAN,CAAW,IAAX,EAAiBD,GAAjB,CAAP;AACA,CAFD;;AAIA,eAAe,SAASE,IAAT,GAAgB;AAC9B,QAAM;AAAEC,IAAAA,EAAF;AAAMC,IAAAA,KAAN;AAAaC,IAAAA,MAAb;AAAqBC,IAAAA;AAArB,MAA8BvB,QAAQ,EAA5C;AACA,QAAMwB,IAAI,GAAGzB,SAAS,CAACG,eAAD,CAAtB;AACA,QAAMuB,QAAQ,GAAG5B,OAAO,CAAC,MAAM;AAC9B,UAAM4B,QAAQ,GAAG,IAAIrB,cAAJ,CAAmBgB,EAAnB,CAAjB;AACAK,IAAAA,QAAQ,CAACC,OAAT,CAAiB,IAAIpB,UAAJ,CAAee,KAAf,EAAsBC,MAAtB,CAAjB;AAEA,UAAMK,UAAU,GAAG,IAAIpB,UAAJ,CAAe,GAAGiB,IAAlB,CAAnB;AACAG,IAAAA,UAAU,CAACC,kBAAX,CAA8BC,yBAA9B,CAAwD,GAAxD;AAEA,UAAMC,UAAU,GAAG,IAAInB,UAAJ,CAAeU,KAAf,EAAsBC,MAAtB,CAAnB;AACA,UAAMS,UAAU,GAAG,IAAIrB,UAAJ,CAAeY,MAAf,EAAuBQ,UAAU,CAACE,YAAX,CAAwBC,OAA/C,EAAwD;AAC1EC,MAAAA,aAAa,EAAE/B,aAAa,CAACgC,QAD6C;AAE1EC,MAAAA,OAAO,EAAE,EAFiE;AAG1EC,MAAAA,KAAK,EAAE,CAHmE;AAI1EC,MAAAA,iBAAiB,EAAE,CAJuD;AAIpD;AACtBC,MAAAA,eAAe,EAAE,GALyD;AAKpD;AACtBC,MAAAA,cAAc,EAAE,IAN0D;AAMpD;AACtBC,MAAAA,YAAY,EAAE,IAP4D;AAQ1EC,MAAAA,kBAAkB,EAAE,GARsD;AAS1EC,MAAAA,MAAM,EAAE,EATkE;AAU1EC,MAAAA,KAAK,EAAE,IAVmE;AAW1EC,MAAAA,IAAI,EAAE;AAXoE,KAAxD,CAAnB;AAcA,UAAMC,UAAU,GAAG,IAAIzC,UAAJ,CAAeiB,MAAf,EAAuBK,UAAvB,EAAmCI,UAAnC,CAAnB;AACAe,IAAAA,UAAU,CAACC,cAAX,GAA4B,IAA5B;AACAtB,IAAAA,QAAQ,CAACC,OAAT,CAAiBI,UAAjB;AACAL,IAAAA,QAAQ,CAACC,OAAT,CAAiBoB,UAAjB;AACA,WAAOrB,QAAP;AACA,GA3BuB,EA2BrB,EA3BqB,CAAxB;AA6BA3B,EAAAA,SAAS,CAAC,MAAM,KAAK2B,QAAQ,CAACuB,OAAT,CAAiBzB,IAAI,CAAC0B,KAAtB,EAA6B1B,IAAI,CAAC2B,MAAlC,CAAZ,EAAuD,CAAE3B,IAAF,CAAvD,CAAT;AACA,SAAOtB,QAAQ,CAAC,CAACe,CAAD,EAAImC,KAAJ,KAAc1B,QAAQ,CAAC2B,MAAT,CAAgBD,KAAhB,CAAf,EAAuC,CAAvC,CAAf;AACA","sourcesContent":["import { useMemo, useEffect } from 'react';\nimport { useLoader, useThree, useFrame } from 'react-three-fiber';\nimport {\n\tSMAAImageLoader,\n\tBlendFunction,\n\tEffectComposer,\n\tEffectPass,\n\tRenderPass,\n\tSMAAEffect,\n\tEdgeDetectionMode,\n\tSMAAPreset,\n\tSSAOEffect,\n\tNormalPass,\n} from 'postprocessing/build/postprocessing';\nimport {\n\tHalfFloatType,\n} from 'three';\n\n// Fix smaa loader signature\nconst _load = SMAAImageLoader.prototype.load;\n\nSMAAImageLoader.prototype.load = function(_, set) {\n\treturn _load.bind(this)(set);\n};\n\nexport default function Post() {\n\tconst { gl, scene, camera, size } = useThree();\n\tconst smaa = useLoader(SMAAImageLoader);\n\tconst composer = useMemo(() => {\n\t\tconst composer = new EffectComposer(gl);\n\t\tcomposer.addPass(new RenderPass(scene, camera));\n\n\t\tconst smaaEffect = new SMAAEffect(...smaa);\n\t\tsmaaEffect.colorEdgesMaterial.setEdgeDetectionThreshold(0.1);\n\n\t\tconst normalPass = new NormalPass(scene, camera);\n\t\tconst ssaoEffect = new SSAOEffect(camera, normalPass.renderTarget.texture, {\n\t\t\tblendFunction: BlendFunction.MULTIPLY,\n\t\t\tsamples: 30,\n\t\t\trings: 4,\n\t\t\tdistanceThreshold: 1, // Render distance depends on camera near&far.\n\t\t\tdistanceFalloff: 0.0, // No need for falloff.\n\t\t\trangeThreshold: 0.05, // Larger value works better for this camera frustum.\n\t\t\trangeFalloff: 0.01,\n\t\t\tluminanceInfluence: 0.6,\n\t\t\tradius: 30,\n\t\t\tscale: 0.55,\n\t\t\tbias: 0.5\n\t\t});\n\t\t\n\t\tconst effectPass = new EffectPass(camera, smaaEffect, ssaoEffect);\n\t\teffectPass.renderToScreen = true;\n\t\tcomposer.addPass(normalPass);\n\t\tcomposer.addPass(effectPass);\n\t\treturn composer;\n\t}, []);\n\n\tuseEffect(() => void composer.setSize(size.width, size.height), [ size ]);\n\treturn useFrame((_, delta) => composer.render(delta), 1);\n}\n"]},"metadata":{},"sourceType":"module"}